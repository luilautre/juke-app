<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Juke-app</title>
<style>
  body {
    font-family: system-ui, sans-serif;
    background: #fdf8f3;
    text-align: center;
    padding: 2em;
  }
  h1 { color: #d66b00; }
  input {
    width: 90%;
    max-width: 400px;
    padding: 0.8em;
    margin: 1em 0;
    border: 2px solid #d66b00;
    border-radius: 10px;
    font-size: 1em;
  }
  button {
    background: #d66b00;
    color: #fff;
    border: none;
    padding: 0.8em 2em;
    border-radius: 10px;
    font-size: 1em;
    cursor: pointer;
    margin: 0.5em;
  }
  button:hover { background: #ff7f00; }
  #msg { font-size: 0.9em; color: #555; margin-top: 0.5em; }

  /* Styles pour player=true */
  body.player { background: #000; color: #fff; padding:0; text-align:center; }
  body.player input, body.player button { font-size:1em; width:auto; margin:5px; padding:0.5em; border-radius:6px; }
  body.player input { max-width:80%; }
</style>
</head>
<body>

<h1 id="title">üéµ <a id="home" href="./" style="color: #d66b00;">Juke-app</a></h1>
<img src="images/logo-orange.svg" style="height: 200px; width: auto;">
<div id="normalUI">
  <p>Recherche ta musique sur ces plateformes :</p>
  <input id="search" type="text" placeholder="Rechercher üîç"><br>
  <button onclick="searchYTMusic()">YouTube Music</button>
  <button onclick="searchDeezer()">Deezer</button>
  <button onclick="searchSC()">SoundCloud</button><br><br>
  <input id="link" type="url" placeholder="Colle le lien ici"><br>
  <button onclick="addMusic()">üé∂ Ajouter</button>
  <p id="msg"></p>
</div>

<script>
const params = new URLSearchParams(window.location.search);
const cafe = params.get('caf√©')||params.get('cafe')||'default';
const playerMode = params.get('player')==='true';
const msg = document.getElementById('msg');
const normalUI = document.getElementById('normalUI');

// Si player=true : simplifier l'affichage
if(playerMode){
  document.body.classList.add('player');
  const aHome = document.getElementById('home')
  aHome.href="#"
  normalUI.querySelector('p').textContent = 'Ajouter une musique :';
  document.getElementById('title').style.fontSize = '1.5em';
}

// Fonctions de recherche
function searchDeezer() {
  const q = encodeURIComponent(document.getElementById('search').value.trim());
  window.open(q?`https://www.deezer.com/search/${q}`:'https://www.deezer.com/fr/channels/explore','_blank','width=1000,height=700');
}
function searchYTMusic() {
  const q = encodeURIComponent(document.getElementById('search').value.trim());
  window.open(q?`https://music.youtube.com/search?q=${q}`:'https://music.youtube.com/','_blank','width=1000,height=700');
}
function searchSC() {
  const q = encodeURIComponent(document.getElementById('search').value.trim());
  window.open(q?`https://soundcloud.com/search?q=${q}`:'https://soundcloud.com/explore','_blank','width=1000,height=700');
}
function envoyerFermer() {
  window.opener.postMessage(
  { type: "TRACK_ADDED", title: "OK" },
  "*");
  setTimeout(()=>window.close(),800);
}

// Ajout musique
async function addMusic(){
  const link = document.getElementById('link').value.trim();
  if(!link.startsWith('http')){ msg.textContent='‚ö†Ô∏è Entre un lien valide.'; return; }

  try{
    const res = await fetch(`/add?caf√©=${encodeURIComponent(cafe)}&link=${encodeURIComponent(link)}`);
    if(res.ok){
      msg.textContent='‚úÖ Musique ajout√©e !';
      document.getElementById('link').value='';
      document.getElementById('search').value='';
      // Si player=true : fermer la fen√™tre
      if(playerMode) setTimeout(()=>envoyerFermer(),800);
    }else{
      msg.textContent='‚ùå Erreur.';
    }
  }catch(e){
    msg.textContent='‚ö†Ô∏è Erreur r√©seau. (veuillez signaler cette erreur au)';
  }
}
</script>
</body>
</html>